<!DOCTYPE html>
<html lang="en-us">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.1.0/es5/tex-mml-chtml.min.js" integrity="sha512-ARgWTEVpGUlOMJL4bRTZtbFUs3LjpPC0YTRJc5FC1KVT18OTBb18Jowb6Is185zStFYyfUJhDgiHVzvt8w+8pg==" crossorigin="anonymous"></script>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="icon" type="image/png" href="https://openforcefield.org/favicon/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://openforcefield.org/favicon/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://openforcefield.org/favicon/favicon-32x32.png">
  <link rel="icon" type="image/ico" href="https://openforcefield.org/favicon/favicon.ico">
	<link rel="manifest" href="https://openforcefield.org/site.webmanifest">
	<title>How to train your force field</title>
	
	
	
	<link rel="stylesheet" href="https://openforcefield.org/sass/index.min.d78ed623887aea8d388ea2b269ff6bd6f793863913d7532af625373655e478c5.css">
	
	
	<script type="text/javascript" src="https://openforcefield.org/js/jquery.min.js"></script>
	
	<script type="text/javascript" src="https://openforcefield.org/js/script.min.js"></script>
</head>
<body class="" data-color="default">
	



<div class="menu-button"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
  <path d="M1 3v2h18V3zm0 8h18V9H1zm0 6h18v-2H1z"/>
</svg>
</div>
<header>
	<a href="https://openforcefield.org/" class="logo"><img src="/img/icon.svg" /></a>
	
		<nav>
			<ul>
				<li>
					<a href="https://openforcefield.org/" class="menu-home">Home</a>
				</li>
				
					
					
					<li class=""><a data-menu="about" href="https://openforcefield.org/about/organization/">About</a></li>
					
						<div class="submenus-mobile">
							<div class="submenu " data-submenu="about">
								<nav>
									<ul>
										
											<li><a href="https://openforcefield.org/about/organization/" class="">Organization</a></li>
										
											<li><a href="https://openforcefield.org/about/roadmap/" class="">Roadmap</a></li>
										
											<li><a href="https://openforcefield.org/about/team/" class="">Team</a></li>
										
											<li><a href="https://openforcefield.org/about/careers/openff/" class="">Careers</a></li>
										
											<li><a href="https://openforcefield.org/about/branding/" class="">Branding</a></li>
										
									</ul>
								</nav>
							</div>
						</div>
					
				
					
					
					<li class=""><a data-menu="science" href="https://openforcefield.org/science/research">Science</a></li>
					
						<div class="submenus-mobile">
							<div class="submenu " data-submenu="science">
								<nav>
									<ul>
										
											<li><a href="https://openforcefield.org/science/research/" class="">Research</a></li>
										
											<li><a href="https://openforcefield.org/science/publications/" class="">Publications</a></li>
										
											<li><a href="https://openforcefield.org/science/collaborative-projects/" class="">Collaborative projects</a></li>
										
											<li><a href="https://openforcefield.org/science/how-to-cite/" class="">How to cite</a></li>
										
									</ul>
								</nav>
							</div>
						</div>
					
				
					
					
					<li class=""><a data-menu="software" href="https://openforcefield.org/software">Software</a></li>
					
				
					
					
					<li class=""><a data-menu="data" href="https://openforcefield.org/data">Data</a></li>
					
				
					
					
					<li class=""><a data-menu="force-fields" href="https://openforcefield.org/force-fields/force-fields/">Force Fields</a></li>
					
						<div class="submenus-mobile">
							<div class="submenu " data-submenu="force-fields">
								<nav>
									<ul>
										
											<li><a href="https://openforcefield.org/force-fields/force-fields/" class="">Force Fields</a></li>
										
											<li><a href="https://openforcefield.org/force-fields/versioning/" class="">Versioning</a></li>
										
									</ul>
								</nav>
							</div>
						</div>
					
				
					
					
						
					
					<li class="active"><a data-menu="community" href="https://openforcefield.org/community/news/general/">Community</a></li>
					
						<div class="submenus-mobile">
							<div class="submenu active" data-submenu="community">
								<nav>
									<ul>
										
											<li><a href="https://openforcefield.org/community/news/general/" class="">News</a></li>
										
											<li><a href="https://openforcefield.org/community/events/webinars/" class="">Events</a></li>
										
											<li><a href="https://openforcefield.org/community/collaborate" class="">Collaborate</a></li>
										
											<li><a href="https://openforcefield.org/community/faq/" class="">FAQ</a></li>
										
											<li><a href="https://discourse.openforcefield.org/" class="">Forum</a></li>
										
									</ul>
								</nav>
							</div>
						</div>
					
				
					
					
					<li class=""><a data-menu="how-to-join" href="https://openforcefield.org/how-to-join">How to join</a></li>
					
				
			</ul>
		</nav>
	
	<div class="search-button" style="display: none">
		<img src="/img/search.svg" />
	</div>
</header>
<div class="menu-back"></div>
<div class="submenus active">
	
		
			<div class="submenu " data-submenu="about">
				<nav>
					<ul>
						
							<li><a href="https://openforcefield.org/about/organization/" class="">Organization</a></li>
						
							<li><a href="https://openforcefield.org/about/roadmap/" class="">Roadmap</a></li>
						
							<li><a href="https://openforcefield.org/about/team/" class="">Team</a></li>
						
							<li><a href="https://openforcefield.org/about/careers/openff/" class="">Careers</a></li>
						
							<li><a href="https://openforcefield.org/about/branding/" class="">Branding</a></li>
						
					</ul>
				</nav>
			</div>
		
	
		
			<div class="submenu " data-submenu="science">
				<nav>
					<ul>
						
							<li><a href="https://openforcefield.org/science/research/" class="">Research</a></li>
						
							<li><a href="https://openforcefield.org/science/publications/" class="">Publications</a></li>
						
							<li><a href="https://openforcefield.org/science/collaborative-projects/" class="">Collaborative projects</a></li>
						
							<li><a href="https://openforcefield.org/science/how-to-cite/" class="">How to cite</a></li>
						
					</ul>
				</nav>
			</div>
		
	
		
	
		
	
		
			<div class="submenu " data-submenu="force-fields">
				<nav>
					<ul>
						
							<li><a href="https://openforcefield.org/force-fields/force-fields/" class="">Force Fields</a></li>
						
							<li><a href="https://openforcefield.org/force-fields/versioning/" class="">Versioning</a></li>
						
					</ul>
				</nav>
			</div>
		
	
		
			<div class="submenu active" data-submenu="community">
				<nav>
					<ul>
						
							<li><a href="https://openforcefield.org/community/news/general/" class="">News</a></li>
						
							<li><a href="https://openforcefield.org/community/events/webinars/" class="">Events</a></li>
						
							<li><a href="https://openforcefield.org/community/collaborate" class="">Collaborate</a></li>
						
							<li><a href="https://openforcefield.org/community/faq/" class="">FAQ</a></li>
						
							<li><a href="https://discourse.openforcefield.org/" class="">Forum</a></li>
						
					</ul>
				</nav>
			</div>
		
	
		
	
</div>

	<div class="subheader">
		<h1><b>open</b> force field</h1>
		<h3>An open and collaborative approach to better force fields</h3>
		
		

		
		
		
		
	</div>


	
		
	
	
		
		
				
	
	
		
		
				
	
	
		
		
			
				
					
				
			
				
					
				
			
			
				<div class="subheader-menu">
					<div>
						
							
								
							
							
								<div>
									<b><a href="https://openforcefield.org/community/news/general/" class="">News</a></b>
								</div>
							
						
							
								
							
							
								<div>
									<b><a href="https://openforcefield.org/community/news/science-updates/" class="">Science Updates</a></b>
								</div>
							
						
					</div>
				</div>
			
		
	

		
	

		
	

	<main class="single">
		<article>
			<h1>How to train your force field</h1>
			
				<h6>
			
			
				Posted on 1 Jul 2021
			
			
				by Simon Boothroyd
			
			
				</h6>
			
			<div>
				<p>Within Open Force Field (as the name might suggest) a lot of time and effort is spent exploring exactly how should
force fields be trained - what data should be fit to? how should that data influence the optimization e.g. L1, L2? what
classical functional forms should be used for the force field interactions? or should everything just be machine learned
<em>a la</em> ANI and friends.</p>
<p>A big part of this process is automation. No one wants to manually trawl through millions of molecules by hand when
building a train / test set, or painstakingly set up and store thousands of quantum chemical calculations to train
against. Ideally, training a force field should be at the level of &rsquo;these are the kinds of chemistry&rsquo;s I&rsquo;m interested
in, this is the type of data I want to train against, let me vary these hyperparameters, and let me hit a big green GO
button!'.</p>
<p>It is this level of abstraction that Open Force Field is working towards, both in terms of its software pipelines and
its general workflows and procedures, and it is these that I will be diving into as part of this blog post!</p>
<aside class="admonition note">
    <div class="title">Note</div>
    <div class="content">The Open Force Field infrastructure is currently rapidly evolving and so parts of this blog post may become
out of date as time progresses.</div>
</aside>
<p>I will be writing this post as if it were to be written in a Jupyter notebook (indeed, I am writing this in a Jupyter
notebook!) so that you the reader can follow along and in principle build your own force field!</p>
<p>It will be structured into several parts:</p>
<ul>
<li>
<p>first, we will be locally generating a small quantum chemical data set of torsion drives that we can train the
parameters in our force field against.</p>
</li>
<li>
<p>next, we will complement the torsion drives with a set of optimised geometries that we will retrieve from the
bountiful <a href="https://qcarchive.molssi.org/">QCArchive</a> repository</p>
</li>
<li>
<p>after that, we will create a <em>schema</em> (essentially a blueprint) defining how the force field will be trained</p>
</li>
<li>
<p>and finally, we will hit the big green GO button and train the force field!</p>
</li>
</ul>
<h3 id="following-along">Following along</h3>
<p>If you would like to follow along with the steps that I will be showing here I recommend first creating a new <a href="https://gist.github.com/SimonBoothroyd/2405bd7d15c2908227ad42bfe3a79064#file-environment-yml">conda
environment</a> with all of the neccessary dependencies:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>conda env create <span style="color:#f92672">--</span>name build<span style="color:#f92672">-</span>a<span style="color:#f92672">-</span>force<span style="color:#f92672">-</span>field <span style="color:#f92672">--</span>file do<span style="color:#f92672">-</span>you<span style="color:#f92672">-</span>want<span style="color:#f92672">-</span>to<span style="color:#f92672">-</span>train<span style="color:#f92672">-</span>a<span style="color:#f92672">-</span>force<span style="color:#f92672">-</span>field<span style="color:#f92672">.</span>yml
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">!</span>conda activate build<span style="color:#f92672">-</span>a<span style="color:#f92672">-</span>force<span style="color:#f92672">-</span>field
</span></span></code></pre></div><p>A completed Jupyter notebook <a href="https://mybinder.org/v2/gist/SimonBoothroyd/2405bd7d15c2908227ad42bfe3a79064#file-how-to-build-a-force-field-ipynb/HEAD?filepath=how-to-build-a-force-field.ipynb">can be found on MyBinder</a>.</p>
<h2 id="generating-a-qc-torsion-drive-training-set">Generating a QC torsion drive training set</h2>
<p>As you might expect, the first step in training a new force field is generating a suite of reference data to train
against. While the Open Force Field consortium routinely works with both QC and <a href="https://openff-evaluator.readthedocs.io/en/latest/datasets/curation.html">experimental physical property
data</a> when building its force fields,
I will &lsquo;only&rsquo; be talking about training to QC data here to keep things short and sweet!</p>
<p>The two main players in Open Force Fields QC data generation are the MolSSI QC ecosystem (<a href="http://docs.qcarchive.molssi.org/projects/qcfractal/en/latest/">QCFractal</a> in particular) and the <a href="https://openff-qcsubmit.readthedocs.io/en/latest/">OpenFF QCSubmit</a> package.</p>
<p>So what do these two packages do? Well, to quote their documentation, QCFractal is</p>
<blockquote>
<p>a distributed compute and database platform for quantum chemistry.</p>
</blockquote>
<p>and QCSubmit provides</p>
<blockquote>
<p>automated tools for submitting molecules to QCFractal and retrieving the results</p>
</blockquote>
<p>Simply put, QCSubmit allows us to curate large datasets of molecules that QCFractal can then perform QC calculations on
in a way that scales across hundreds of compute resources without human intervention - i.e. no more manually runing
Psi4 or Gaussian 🎉!</p>
<h3 id="preparing-the-training-set">Preparing the training set</h3>
<p>So how we do use these packages? Let&rsquo;s start by specifying a bunch of molecules that we want to train our force field
against!</p>
<p>While the consortium is currently working on procedures to fully automate the process of <a href="https://www.youtube.com/watch?v=HBpzVZI2rkI&amp;ab_channel=OpenForceFieldInitiative">selecting training sets</a> to ensure comprehensive swathes of
relevant chemical spaces are covered, it does not yet provide packaged tools to do this (watch this space!).</p>
<p>Instead, for this blog post we will be training a force field for (wait for it) some linear alkanes 🎉🎉🎉!
Ok it may not be the most exciting set, but I mainly want to show the process by which we can train a force field
without needing a whole supercomputers worth of resources. This process itself can (and routinely does) handle datasets
of thousands of unique molecules with diverse chemistry&rsquo;s.</p>
<p>Let&rsquo;s define these molecules now:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.toolkit.topology <span style="color:#f92672">import</span> Molecule
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>training_smiles <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;CC&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;CCCC&#34;</span>,
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>training_molecules <span style="color:#f92672">=</span> [Molecule<span style="color:#f92672">.</span>from_smiles(smiles) <span style="color:#66d9ef">for</span> smiles <span style="color:#f92672">in</span> training_smiles]
</span></span></code></pre></div><p>We have the molecules, but how do we turn these into a set of QC calculations to run? This is where QCSubmit comes in!
The package allows us to create a &lsquo;factory&rsquo; that does exactly this mapping.</p>
<p>Let&rsquo;s create the factory we&rsquo;ll be using:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.qcsubmit.common_structures <span style="color:#f92672">import</span> QCSpec
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.qcsubmit.factories <span style="color:#f92672">import</span> TorsiondriveDatasetFactory
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.qcsubmit.workflow_components <span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    Scan1D, ScanEnumerator, StandardConformerGenerator
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>torsion_drive_factory <span style="color:#f92672">=</span> TorsiondriveDatasetFactory(
</span></span><span style="display:flex;"><span>    qc_specifications<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;default&#34;</span>: QCSpec(
</span></span><span style="display:flex;"><span>            method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;B3LYP-D3BJ&#34;</span>, basis<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;DZVP&#34;</span>, program<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;psi4&#34;</span>
</span></span><span style="display:flex;"><span>        ),
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    workflow<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>        ScanEnumerator(
</span></span><span style="display:flex;"><span>            torsion_scans<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>                Scan1D(
</span></span><span style="display:flex;"><span>                    smarts1<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[*:1]-[#6:2]-[#6:3]-[*:4]&#34;</span>,
</span></span><span style="display:flex;"><span>                    scan_range1<span style="color:#f92672">=</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">150</span>, <span style="color:#ae81ff">180</span>),
</span></span><span style="display:flex;"><span>                    scan_increment<span style="color:#f92672">=</span>[<span style="color:#ae81ff">30</span>]
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        ),
</span></span><span style="display:flex;"><span>        StandardConformerGenerator(toolkit<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rdkit&#34;</span>, max_conformers<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>As you can probably see we have here created a <code>TorsiondriveDatasetFactory</code> that will be used to produce, as you can
probably guess, datasets of QC torsion drives. You probably also won&rsquo;t be surprised to learn that QCSubmit provides
<a href="https://openff-qcsubmit.readthedocs.io/en/latest/api.html">several types of factories</a> for the different types of QC
calculation supported by QCFractal. For now though, let&rsquo;s focus on torsion drives.</p>
<p>We provide 2 key ingredients to our factory:</p>
<ul>
<li>
<p>a set of QC &lsquo;specifications&rsquo; - a QC specification is where we define the level of theory as well as the program with
which we want to run our calculations. Here we have used the &lsquo;Open Force Field defaults&rsquo; which were carefully chosen
to provide a balance of speed and accuracy at reproducing conformational energies.</p>
</li>
<li>
<p>a &lsquo;workflow&rsquo; - the workflow contains a set of processing steps that will be applied to an input set of molecules.
These range from generating a set of conformers for each molecule to start the torsion drive from, enumerating all
tautomers and protomers of the input molecules, fragmenting the input molecules to speed up the QC calculations and
much more!</p>
</li>
</ul>
<p>Here we have used two workflow components: i) a conformer generator which ensures that <a href="https://torsiondrive.readthedocs.io/en/latest/">we have several conformers to
start the torsion drive from</a> and ii) a component that defines exactly
which torsions should be scanned. As with most things in the OpenFF ecosystem, we have used a <a href="https://docs.eyesopen.com/toolkits/cpp/oechemtk/SMARTS.html">SMARTS pattern</a> to define the chemical environments that we would like to
scan. This particular pattern will match all unique torsions around a C-C single bond.</p>
<p>Great - we have our molecules and we have a factory. Let&rsquo;s now combine the two and create the dataset of QC calculations
that QCFractal should run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>torsion_drive_dataset <span style="color:#f92672">=</span> torsion_drive_factory<span style="color:#f92672">.</span>create_dataset(
</span></span><span style="display:flex;"><span>    molecules<span style="color:#f92672">=</span>training_molecules,
</span></span><span style="display:flex;"><span>    dataset_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Alkane Torsion Drives&#34;</span>,
</span></span><span style="display:flex;"><span>    description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;A very basic dataset containing three linear alkanes: &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;ethane, propane, and butane.&#34;</span>,
</span></span><span style="display:flex;"><span>    tagline<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;A very basic dataset containing three linear alkanes.&#34;</span>,
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><h3 id="computing-the-training-set">Computing the training set</h3>
<p>With the QC dataset prepared, we can move on to actually running the calculations that will be used in training.</p>
<p>The workhorse of the Open Force Field QC data generation is the QCFractal package and its <a href="http://docs.qcarchive.molssi.org/en/latest/">surrounding ecosystem</a>. It provides a simple interface for computing and storing data sets of QC
calculations, being able to scale from a single laptop all the way up to multiple supercomputers located around the
globe.</p>
<p>While the bulk of the QC training and test sets the Open Force Field uses (as we will see later in this post) are
computed and stored in MolSSIs public QCFractal instance (<a href="https://qcarchive.molssi.org/">the QCArchive</a>), here we will
be spinning up a temporary local QCFractal to better showcase how simple generating new QC data is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> qcfractal <span style="color:#f92672">import</span> FractalSnowflakeHandler
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> qcportal.client <span style="color:#f92672">import</span> FractalClient
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>local_fractal_instance <span style="color:#f92672">=</span> FractalSnowflakeHandler(ncores<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>local_fractal_client <span style="color:#f92672">=</span> FractalClient(local_fractal_instance)
</span></span></code></pre></div><p><em>see the <a href="http://docs.qcarchive.molssi.org/projects/qcfractal/en/latest/setup_quickstart.html">main QCFractal documentation</a>
for more information about setting up local instances to compute and store your non-public data</em></p>
<p>Submitting, computing, and finally storing a QC dataset is as easy as calling the submit command and providing the
address of the server that should handle the submission:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>submission <span style="color:#f92672">=</span> torsion_drive_dataset<span style="color:#f92672">.</span>submit(local_fractal_client)
</span></span></code></pre></div><p>We can check on the progress of our calculations by querying the fractal instance:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>local_fractal_client<span style="color:#f92672">.</span>query_procedures(procedure<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;torsiondrive&#34;</span>, status<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>)
</span></span></code></pre></div><pre><code>[TorsionDriveRecord(id='1', status='INCOMPLETE'),
 TorsionDriveRecord(id='2', status='INCOMPLETE'),
 TorsionDriveRecord(id='3', status='INCOMPLETE')]
</code></pre>
<p>Let&rsquo;s query the server every 60 seconds until we get the all clear that our calculations have finished:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> time <span style="color:#f92672">import</span> sleep, time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>n_completed <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>n_errored <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>start_time <span style="color:#f92672">=</span> time()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> n_completed <span style="color:#f92672">+</span> n_errored <span style="color:#f92672">!=</span> torsion_drive_dataset<span style="color:#f92672">.</span>n_records:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    sleep(<span style="color:#ae81ff">60</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    n_completed <span style="color:#f92672">=</span> len(local_fractal_client<span style="color:#f92672">.</span>query_procedures(
</span></span><span style="display:flex;"><span>        procedure<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;torsiondrive&#34;</span>, status<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;COMPLETE&#34;</span>
</span></span><span style="display:flex;"><span>    ))
</span></span><span style="display:flex;"><span>    n_errored <span style="color:#f92672">=</span> len(local_fractal_client<span style="color:#f92672">.</span>query_procedures(
</span></span><span style="display:flex;"><span>        procedure<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;torsiondrive&#34;</span>, status<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ERROR&#34;</span>
</span></span><span style="display:flex;"><span>    ))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;N COMPLETED: </span><span style="color:#e6db74">{</span>n_completed<span style="color:#e6db74">}</span><span style="color:#e6db74"> N ERRORED: </span><span style="color:#e6db74">{</span>n_errored<span style="color:#e6db74">}</span><span style="color:#e6db74"> ELAPSED=</span><span style="color:#e6db74">{</span>time() <span style="color:#f92672">-</span> start_time<span style="color:#e6db74">}</span><span style="color:#e6db74">s&#34;</span>)
</span></span></code></pre></div><pre><code>N COMPLETED: 3 N ERRORED: 0 ELAPSED=3485.364670276642s
</code></pre>
<p>If everything went well we should see that we have three completed torsion drives and zero errored.</p>
<p>And that&rsquo;s it - we now have a set of torsion drives ready to train our force field against!</p>
<h2 id="retrieving-a-remote-qc-optimization-training-set">Retrieving a remote QC optimization training set</h2>
<p>Almost all the QC data that Open Force Field generates, whether that be for production force fields or smaller
scientific studies, are made available via the public <a href="https://qcarchive.molssi.org/">QCArchive</a> repository. This
is not only part of the consortiums&rsquo; effort to make all the science it performs completely accessible and reproducible,
but so that anyone can use it as part of their efforts!</p>
<p>We are going to retrieve a set of optimised geometries for our training molecules that were computed as part of a
previous Open Force Field dataset. To do this we will again be using the fantastic QCSubmit package.</p>
<p>The QCSubmit package, in addition to data curation and submission, contains a suite of utilities for retrieving
data from a running QCFractal instance. This functionality is provided by several <a href="https://openff-qcsubmit.readthedocs.io/en/latest/examples/retrieving-results.html">&lsquo;result collections&rsquo;</a> - one for each type of QC data that
can be retrieved.</p>
<p>To pull down optimization data we will (surprise, surprise) using the optimization result collection:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Create a client which allows us to connect to the main QCArchive server.</span>
</span></span><span style="display:flex;"><span>qcarchive_client <span style="color:#f92672">=</span> FractalClient()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Retrieve the data set containing the molecules of interest.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.qcsubmit.results <span style="color:#f92672">import</span> OptimizationResultCollection
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>optimization_result_collection <span style="color:#f92672">=</span> OptimizationResultCollection<span style="color:#f92672">.</span>from_server(
</span></span><span style="display:flex;"><span>    client<span style="color:#f92672">=</span>qcarchive_client,
</span></span><span style="display:flex;"><span>    datasets<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;OpenFF Sandbox CHO PhAlkEthOH v1.0&#34;</span>],
</span></span><span style="display:flex;"><span>    spec_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;default&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>Here we have retrieved the &lsquo;OpenFF Sandbox CHO PhAlkEthOH v1.0&rsquo; dataset which, as the name may suggest, contains
a collection of optimised geometries of alkyl, aryl, and hydroxyl containing molecules composed only of carbon, oxygen
and hydrogen.</p>
<p>We can see that it contains thousands of unique molecules and corresponding optimized geometries:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;N RESULTS:   </span><span style="color:#e6db74">{</span>optimization_result_collection<span style="color:#f92672">.</span>n_results<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;N MOLECULES: </span><span style="color:#e6db74">{</span>optimization_result_collection<span style="color:#f92672">.</span>n_molecules<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><pre><code>N RESULTS:   12271
N MOLECULES: 10301
</code></pre>
<p>Ideally we&rsquo;d like to filter down this collection to only include our molecules of interest&hellip; luckily, QCSubmit provides
exactly this functionality:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.qcsubmit.results.filters <span style="color:#f92672">import</span> SMILESFilter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>optimization_result_collection <span style="color:#f92672">=</span> optimization_result_collection<span style="color:#f92672">.</span>filter(
</span></span><span style="display:flex;"><span>    SMILESFilter(smiles_to_include<span style="color:#f92672">=</span>training_smiles)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;N RESULTS:   </span><span style="color:#e6db74">{</span>optimization_result_collection<span style="color:#f92672">.</span>n_results<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;N MOLECULES: </span><span style="color:#e6db74">{</span>optimization_result_collection<span style="color:#f92672">.</span>n_molecules<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><pre><code>N RESULTS:   2
N MOLECULES: 2
</code></pre>
<p>Much better! The filters provided by QCSubmit go well beyond simple SMILES based filtering - I&rsquo;d highly recommend taking
a look at the <a href="https://openff-qcsubmit.readthedocs.io/en/latest/examples/retrieving-results.html#Filtering-result-collections">QCSubmit documentation</a>
for more details!</p>
<p>To finish off, we will also retrieve the torsion drive results that we generated earlier on and store a reference to
them in a result collection:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.qcsubmit.results <span style="color:#f92672">import</span> TorsionDriveResultCollection
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>torsion_drive_result_collection <span style="color:#f92672">=</span> TorsionDriveResultCollection<span style="color:#f92672">.</span>from_server(
</span></span><span style="display:flex;"><span>    client<span style="color:#f92672">=</span>local_fractal_client,
</span></span><span style="display:flex;"><span>    datasets<span style="color:#f92672">=</span>torsion_drive_dataset<span style="color:#f92672">.</span>dataset_name,
</span></span><span style="display:flex;"><span>    spec_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;default&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;N RESULTS:   </span><span style="color:#e6db74">{</span>torsion_drive_result_collection<span style="color:#f92672">.</span>n_results<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;N MOLECULES: </span><span style="color:#e6db74">{</span>torsion_drive_result_collection<span style="color:#f92672">.</span>n_molecules<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><pre><code>N RESULTS:   3
N MOLECULES: 2
</code></pre>
<h2 id="defining-the-training-procedure">Defining the training procedure</h2>
<p>We now have all the data that we will be training against. It&rsquo;s time to begin preparing the actual training process
itself.</p>
<p>In particular, we need to:</p>
<ul>
<li>
<p>load the starting force field that we will be training</p>
</li>
<li>
<p>specify <strong>which</strong> parameters within the force field should be trained</p>
</li>
<li>
<p>specify the hyper-parameters that control <strong>how</strong> the parameters will be trained</p>
</li>
<li>
<p>define the &rsquo;targets&rsquo; that we are training the parameters against</p>
</li>
</ul>
<p>All of this is made easy by the <a href="https://github.com/openforcefield/bespoke-fit">OpenFF Bespoke</a> package. The OpenFF
Bespoke package not only provides the functionality for creating tailor made force fields for individual molecules of
interest, but also provides all the tools needed to train a general transferable force field.</p>
<aside class="admonition note">
    <div class="title">Note</div>
    <div class="content">The OpenFF Bespoke package is still pre-release and is rapidly being developed. While every effort has been made to
ensure scientific correctness, bugs do happen, and we advise caution when using this package.</div>
</aside>
<h3 id="defining-the-parameters-to-train">Defining the parameters to train</h3>
<p>Starting from the top then, we need to load in the force field that we will be training. Here we are going to retrain a
subset of the parameters from the OpenFF 1.3.0 force field:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.toolkit.typing.engines.smirnoff <span style="color:#f92672">import</span> ForceField
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>initial_force_field_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;openff_unconstrained-1.3.0.offxml&#34;</span>
</span></span><span style="display:flex;"><span>initial_force_field <span style="color:#f92672">=</span> ForceField(initial_force_field_path)
</span></span></code></pre></div><p>The force field contains hundreds of parameters that cover a huge span of chemical space. From these, we can easily
extract those parameters that are relevant to our training set by generating a parameter &lsquo;coverage&rsquo; report:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>coverage <span style="color:#f92672">=</span> optimization_result_collection<span style="color:#f92672">.</span>smirnoff_coverage(initial_force_field)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;BONDS&#34;</span>)
</span></span><span style="display:flex;"><span>print([smirks <span style="color:#66d9ef">for</span> smirks <span style="color:#f92672">in</span> coverage[<span style="color:#e6db74">&#34;Bonds&#34;</span>]])
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;ANGLES&#34;</span>)
</span></span><span style="display:flex;"><span>print([smirks <span style="color:#66d9ef">for</span> smirks <span style="color:#f92672">in</span> coverage[<span style="color:#e6db74">&#34;Angles&#34;</span>]])
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;PROPER TORSIONS&#34;</span>)
</span></span><span style="display:flex;"><span>print([smirks <span style="color:#66d9ef">for</span> smirks <span style="color:#f92672">in</span> coverage[<span style="color:#e6db74">&#34;ProperTorsions&#34;</span>]])
</span></span></code></pre></div><pre><code>BONDS
'[#6X4:1]-[#6X4:2]', '[#6X4:1]-[#1:2]'
ANGLES
'[*:1]~[#6X4:2]-[*:3]', '[#1:1]-[#6X4:2]-[#1:3]'
PROPER TORSIONS
'[#6X4:1]-[#6X4:2]-[#6X4:3]-[#6X4:4]', '[#1:1]-[#6X4:2]-[#6X4:3]-[#6X4:4]',
'[#1:1]-[#6X4:2]-[#6X4:3]-[#1:4]'
</code></pre>
<p>As can be seen there are two bond, two angle and three torsion parameters. If you aren&rsquo;t familiar with <a href="https://www.daylight.com/dayhtml/doc/theory/theory.smirks.html">SMIRKS</a> patterns then the above may look a bit daunting&hellip;
Quite simply, a SMIRKS pattern encodes a particular chemical environment. The OpenFF force fields, or more precisely,
<a href="https://openforcefield.github.io/standards/standards/smirnoff/">SMIRNOFF</a> force fields, use these patterns to define
which parameters should be applied to which chemistries.</p>
<p>As an example let&rsquo;s take a look at the SMIRKS parameter associated with our first bond parameter: <code>'[#6X4:1]-[#6X4:2]'</code>.
In a more human language, this pattern defines a chemical environment composed of two sp3 carbon atoms that are joined
by single bond.</p>
<p>Here we are going to train to all the parameters identified by the coverage report:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.bespokefit.schema.smirks <span style="color:#f92672">import</span> AngleSmirks, BondSmirks, ProperTorsionSmirks
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target_parameters <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>[
</span></span><span style="display:flex;"><span>        BondSmirks(smirks<span style="color:#f92672">=</span>smirks, attributes<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;k&#34;</span>, <span style="color:#e6db74">&#34;length&#34;</span>})
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> smirks <span style="color:#f92672">in</span> coverage[<span style="color:#e6db74">&#34;Bonds&#34;</span>]
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>[
</span></span><span style="display:flex;"><span>        AngleSmirks(smirks<span style="color:#f92672">=</span>smirks, attributes<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;k&#34;</span>, <span style="color:#e6db74">&#34;angle&#34;</span>})
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> smirks <span style="color:#f92672">in</span> coverage[<span style="color:#e6db74">&#34;Angles&#34;</span>]
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>[
</span></span><span style="display:flex;"><span>        ProperTorsionSmirks(smirks<span style="color:#f92672">=</span>smirks, attributes<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;k1&#34;</span>})
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> smirks <span style="color:#f92672">in</span> coverage[<span style="color:#e6db74">&#34;ProperTorsions&#34;</span>]
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>We must specify both the SMIRKS pattern associated with the parameters that we want to train, as well as the
individual attributes (e.g. the force constant <code>k</code>, the bond <code>length</code>, the torsion barrier height <code>k1</code>)</p>
<p>For each type of parameter (e.g. bond, angle, proper torsion, etc.) that we will be training we must also specify the
settings that will control how that parameter will be trained. Currently, the only hyper-parameter is a &lsquo;prior&rsquo; to place
on each type of parameter.</p>
<p>Borrowing the language of Bayesian statistics, a &lsquo;prior&rsquo; in this context refers to a light restraint placed on each
type of parameter that ensures that parameter does not change too much from its initial (usually physically motivated)
value. For more details I would recommend watching <a href="https://youtu.be/F_CKbbhiaWQ?t=1070">this fantastic talk</a> by
Lee-Ping Wang who created the <a href="https://github.com/leeping/forcebalance">ForceBalance</a> tool that drives most of the
parameter training undertaken by Open Force Field.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.bespokefit.schema.smirnoff <span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    AngleAngleSettings,
</span></span><span style="display:flex;"><span>    AngleForceSettings,
</span></span><span style="display:flex;"><span>    BondForceSettings,
</span></span><span style="display:flex;"><span>    BondLengthSettings,
</span></span><span style="display:flex;"><span>    ProperTorsionSettings,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>parameter_settings<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>    BondForceSettings(prior<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0e02</span>),
</span></span><span style="display:flex;"><span>    BondLengthSettings(prior<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0e-01</span>),
</span></span><span style="display:flex;"><span>    AngleForceSettings(prior<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0e02</span>),
</span></span><span style="display:flex;"><span>    AngleAngleSettings(prior<span style="color:#f92672">=</span><span style="color:#ae81ff">2.0e01</span>),
</span></span><span style="display:flex;"><span>    ProperTorsionSettings(target<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;k&#34;</span>, prior<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>),
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h3 id="defining-the-fitting-targets">Defining the fitting &rsquo;targets&rsquo;</h3>
<p>With the parameters that will be trained defined, we now need to define the &rsquo;targets&rsquo; that we will be training them
against.</p>
<p>A fitting &rsquo;target&rsquo; defines how deviations from the reference data we defined earlier should contribute to our
loss ( / objective) function. Here we will be using two targets that are routinely used when training new Open Force
Field force fields:</p>
<h4 id="optgeo">OptGeo</h4>
<p>The OptGeo (short for optimised geometry) fitting target penalizes force field parameters that cause conformers that
have been minimised using the force field being trained to deviate strongly from the same conformer minimised using
the reference QM method.</p>
<h4 id="torsionprofile">TorsionProfile</h4>
<p>The torsion profile target penalizes based on the average RMSE between the QM and MM energies evaluated at each scanned
torsion angle.</p>
<p>To define these targets we at minimum need to provide the QC reference data:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.bespokefit.schema.targets <span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    OptGeoTargetSchema,
</span></span><span style="display:flex;"><span>    TorsionProfileTargetSchema,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>targets <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    TorsionProfileTargetSchema(reference_data<span style="color:#f92672">=</span>torsion_drive_result_collection),
</span></span><span style="display:flex;"><span>    OptGeoTargetSchema(reference_data<span style="color:#f92672">=</span>optimization_result_collection),
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>Each of these targets can take a multitude of options which I won&rsquo;t go into detail here, but will be described in much
more detail in the soon to be published OpenFF Bespoke documentation.</p>
<h2 id="training-the-force-field">Training the force field</h2>
<p>We are now finally ready to train the force field! We have stated which parameters will be training, we have defined
the contributions to the loss function (in terms of &lsquo;fitting targets&rsquo;) that we will be trying to minimise, and all that
is left is to tie it all together.</p>
<p>We do this by defining the overall &lsquo;optimization schema&rsquo; - this is a compact python object that encodes every single
input that will be used to train the force field:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.bespokefit.schema.fitting <span style="color:#f92672">import</span> OptimizationSchema
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.bespokefit.schema.optimizers <span style="color:#f92672">import</span> ForceBalanceSchema
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>optimization_schema <span style="color:#f92672">=</span> OptimizationSchema(
</span></span><span style="display:flex;"><span>    id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;linear-alkanes&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Define the force field that we will train</span>
</span></span><span style="display:flex;"><span>    initial_force_field<span style="color:#f92672">=</span>initial_force_field_path,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Define the optimizer</span>
</span></span><span style="display:flex;"><span>    optimizer<span style="color:#f92672">=</span>ForceBalanceSchema(
</span></span><span style="display:flex;"><span>        max_iterations<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>,
</span></span><span style="display:flex;"><span>        step_convergence_threshold<span style="color:#f92672">=</span><span style="color:#ae81ff">0.01</span>,
</span></span><span style="display:flex;"><span>        objective_convergence_threshold<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>,
</span></span><span style="display:flex;"><span>        gradient_convergence_threshold<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>,
</span></span><span style="display:flex;"><span>        n_criteria<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>        initial_trust_radius<span style="color:#f92672">=-</span><span style="color:#ae81ff">1.0</span>,
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Define the torsion profile targets to fit against.</span>
</span></span><span style="display:flex;"><span>    targets<span style="color:#f92672">=</span>targets,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Define the parameters to refit and the priors to place on them.</span>
</span></span><span style="display:flex;"><span>    target_parameters<span style="color:#f92672">=</span>target_parameters,
</span></span><span style="display:flex;"><span>    parameter_settings<span style="color:#f92672">=</span>parameter_settings,
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>as can be seen it is the combination of the starting force field, an optimization engine, the fitting targets, and
the parameters to be trained. It can trivially be saved to disk:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;optimization-schema.json&#34;</span>, <span style="color:#e6db74">&#34;w&#34;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>    file<span style="color:#f92672">.</span>write(optimization_schema<span style="color:#f92672">.</span>json())
</span></span></code></pre></div><p>allowing anyone to try and reproduce the training that was performed simply be reloading the schema and using it as the
input.</p>
<p>Training our force field is as simply as calling <code>optimize</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> openff.bespokefit.optimizers.forcebalance <span style="color:#f92672">import</span> ForceBalanceOptimizer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>results <span style="color:#f92672">=</span> ForceBalanceOptimizer<span style="color:#f92672">.</span>optimize(optimization_schema)
</span></span><span style="display:flex;"><span>results
</span></span></code></pre></div><p>Under the hood, the OpenFF Bespoke is creating all the required input files that will be required, and then calling
out to the optimization engine (in this case ForceBalace) to perform the actual training.</p>
<h2 id="inspecting-the-final-parameters">Inspecting the final parameters</h2>
<p>The results object returned after training the force field contains information collected during the training as well as
the final force field parameters.</p>
<p>Let&rsquo;s print out our initial and final parameters to convince ourselves that something has actually changed!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>final_force_field <span style="color:#f92672">=</span> ForceField(results<span style="color:#f92672">.</span>refit_force_field)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> handler_name <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#34;Bonds&#34;</span>, <span style="color:#e6db74">&#34;Angles&#34;</span>, <span style="color:#e6db74">&#34;ProperTorsions&#34;</span>]:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(handler_name<span style="color:#f92672">.</span>upper() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> smirks <span style="color:#f92672">in</span> coverage[handler_name]:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        initial_parameter <span style="color:#f92672">=</span> initial_force_field[handler_name]<span style="color:#f92672">.</span>parameters[smirks]
</span></span><span style="display:flex;"><span>        final_parameter <span style="color:#f92672">=</span> final_force_field[handler_name]<span style="color:#f92672">.</span>parameters[smirks]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        print(smirks)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;INITIAL: </span><span style="color:#e6db74">{</span>initial_parameter<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;FINAL:   </span><span style="color:#e6db74">{</span>final_parameter<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><pre><code>BONDS

[#6X4:1]-[#6X4:2]
    INITIAL: length: 1.521 A  k: 517.219 kcal/(A**2 mol)
    FINAL:   length: 1.526 A  k: 517.246 kcal/(A**2 mol)
[#6X4:1]-[#1:2]
    INITIAL: length: 1.094 A  k: 754.071 kcal/(A**2 mol)
    FINAL:   length: 1.096 A  k: 754.054 kcal/(A**2 mol)

ANGLES

[*:1]~[#6X4:2]-[*:3]
    INITIAL: angle: 113.657 deg  k: 99.234 kcal/(mol rad**2)
    FINAL:   angle: 114.532 deg  k: 58.458 kcal/(mol rad**2)
[#1:1]-[#6X4:2]-[#1:3]
    INITIAL: angle: 114.294 deg  k: 66.552 kcal/(mol rad**2)
    FINAL:   angle: 111.392 deg  k: 60.785 kcal/(mol rad**2)

PROPER TORSIONS

[#6X4:1]-[#6X4:2]-[#6X4:3]-[#6X4:4]
    INITIAL: k1:  0.116 kcal/mol
    FINAL:   k1:  0.094 kcal/mol
[#1:1]-[#6X4:2]-[#6X4:3]-[#6X4:4]
    INITIAL: k1:  0.084 kcal/mol
    FINAL:   k1: -0.091 kcal/mol
[#1:1]-[#6X4:2]-[#6X4:3]-[#1:4]
    INITIAL: k1:  0.201 kcal/mol
    FINAL:   k1: -0.013 kcal/mol
</code></pre>
<h2 id="conclusions">Conclusions</h2>
<p>And that&rsquo;s all there is to it! As I&rsquo;ve hopefully proved here, the ecosystem provided by the Open Force Field consortium
enables entire force fields to be re-trained from within a single jupyter notebook.</p>
<p>It is an ecosystem that is rapidly evolving, expanding, and improving, and ultimately aims to allow anyone to build
their own force fields without requiring a whole team of researchers. If you found that something was unclear or did not
work as you would expect, the team would love to hear from you! Please reach out to <a href="mailto:support@openforcefield.org">support@openforcefield.org</a> if you
have any feedback or, alternatively, open an issue on one of the consortiums <a href="https://github.com/openforcefield">many GitHub repositories</a>.</p>

			</div>
			
			<div>
				<div id="tags" class="p-y-lg">
					Tags:
					<a href="/tags/force-field">force field</a>, <a href="/tags/infrastructure">infrastructure</a>
				</div>
			</div>
			
		</article>
	</main>

	<footer>
	
	<div class="footer-left">
		
			
				<div><img src="/images/logo.svg" /></div>
			
		
			
				<div>An open and collaborative approach to better force fields</div>
			
		
	</div>
	<div class="footer-column1">
		
			
				<a href="/about" class="">About</a>
			
		
			
				<a href="/about/organization" class="footer-has-child">Organization</a>
			
		
			
				<a href="/about/roadmap" class="footer-has-child">Roadmap</a>
			
		
			
				<a href="/about/team" class="footer-has-child">Team</a>
			
		
			
				<a href="/about/careers" class="footer-has-child">Careers</a>
			
		
			
				<a href="/about/branding" class="footer-has-child">Branding</a>
			
		
	</div>
	<div class="footer-column2">
		
			
				<a href="/science" class="">Science</a>
			
		
			
				<a href="/science/research" class="footer-has-child">Research</a>
			
		
			
				<a href="/science/publications" class="footer-has-child">Publications</a>
			
		
			
				<a href="/science/collaborative-projects/" class="footer-has-child">Collaborative projects</a>
			
		
			
				<a href="/science//how-to-cite/" class="footer-has-child">How to Cite</a>
			
		
	</div>
	<div class="footer-column3">
		
			
				<a href="/software" class="">Software</a>
			
		
			
				<a href="/data" class="">Data</a>
			
		
			
				<a href="/force-fields" class="">Force Fields</a>
			
		
			
				<a href="/force-fields/force-fields" class="footer-has-child">Force Fields</a>
			
		
			
				<a href="/force-fields/versioning" class="footer-has-child">Versioning</a>
			
		
	</div>
	<div class="footer-column4">
		
			
				<a href="/community" class="">Community</a>
			
		
			
				<a href="/community/news" class="footer-has-child">News</a>
			
		
			
				<a href="/community/events" class="footer-has-child">Events</a>
			
		
			
				<a href="/community/collaborate" class="footer-has-child">Collaborate</a>
			
		
			
				<a href="/community/faq" class="footer-has-child">FAQ</a>
			
		
			
				<a href="/community/forum" class="footer-has-child">Forum</a>
			
		
	</div>
	<div class="footer-right">
		
			
				<div>Follow | Subscribe | Connect</div>
			
		
			
				
				
					<a href="mailto:info@openforcefield.org">
				
				<div class="footer-icon"><svg width="19" height="16" viewBox="0 0 19 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M16.585 1.59668H2.72386C1.81252 1.59668 1.07373 2.33547 1.07373 3.24681V13.1476C1.07373 14.0589 1.81252 14.7977 2.72386 14.7977H16.585C17.4963 14.7977 18.2351 14.0589 18.2351 13.1476V3.24681C18.2351 2.33547 17.4963 1.59668 16.585 1.59668Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M3.71387 4.23682L9.65434 8.85719L15.5948 4.23682" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</div>
				
					</a>
				
			
		
			
				
				
					<a href="https://twitter.com/openforcefield">
				
				<div class="footer-icon"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M19.9639 2.31073C19.2404 2.6251 18.4749 2.83221 17.6915 2.92552C18.5148 2.44349 19.1338 1.67768 19.4327 0.771743C18.6544 1.22685 17.8043 1.54617 16.9188 1.71603C16.546 1.32527 16.0976 1.01441 15.6008 0.80234C15.1041 0.590273 14.5694 0.48143 14.0293 0.482429C11.8426 0.482429 10.0729 2.22635 10.0729 4.37611C10.0714 4.67514 10.1057 4.97327 10.175 5.26415C8.60696 5.19064 7.07153 4.79063 5.66693 4.08971C4.26233 3.3888 3.01951 2.40241 2.01796 1.19366C1.6666 1.786 1.48078 2.46184 1.47992 3.15055C1.47992 4.50068 2.18432 5.6941 3.24795 6.39327C2.61778 6.37832 2.00052 6.21153 1.44858 5.90707V5.95528C1.44858 7.84386 2.81478 9.415 4.62299 9.77262C4.28296 9.86327 3.93257 9.90919 3.58066 9.90924C3.33096 9.90968 3.08182 9.88545 2.83688 9.83691C3.33957 11.3839 4.80261 12.5091 6.53568 12.5412C5.12744 13.6265 3.39848 14.2131 1.62056 14.2088C1.30497 14.2083 0.989679 14.1895 0.67627 14.1525C2.48496 15.3074 4.58741 15.9184 6.73338 15.9125C14.0209 15.9125 18.0022 9.97755 18.0022 4.83017C18.0022 4.66141 17.9977 4.49264 17.9897 4.32789C18.7624 3.77822 19.431 3.09514 19.9639 2.31073Z" fill="white"/>
</svg>
</div>
				
					</a>
				
			
		
			
				
				
					<a href="https://github.com/openforcefield">
				
				<div class="footer-icon"><svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8.98633 0.833008C4.36732 0.833008 0.62207 4.67534 0.62207 9.41011C0.62207 13.2002 3.01933 16.4114 6.34263 17.5466C6.38924 17.5567 6.43682 17.5617 6.48452 17.5615C6.79444 17.5615 6.91393 17.3337 6.91393 17.1358C6.91393 16.9305 6.90647 16.3928 6.90273 15.6758C6.62605 15.7407 6.34301 15.7745 6.05884 15.7766C4.44947 15.7766 4.08353 14.5257 4.08353 14.5257C3.70266 13.5362 3.15375 13.2711 3.15375 13.2711C2.42561 12.7595 3.15002 12.7446 3.20603 12.7446H3.20976C4.04992 12.8193 4.49054 13.6333 4.49054 13.6333C4.90875 14.3652 5.46886 14.5706 5.96922 14.5706C6.30007 14.5639 6.6258 14.4876 6.92514 14.3465C6.99982 13.7939 7.21639 13.4167 7.45537 13.2002C5.59955 12.9836 3.64665 12.248 3.64665 8.96202C3.64665 8.02478 3.97151 7.2593 4.50548 6.66185C4.41959 6.44527 4.13207 5.57151 4.58762 4.39155C4.64873 4.37693 4.71153 4.37065 4.77433 4.37288C5.07678 4.37288 5.76011 4.48864 6.8878 5.27279C8.25802 4.88942 9.70717 4.88942 11.0774 5.27279C12.2051 4.48864 12.8884 4.37288 13.1909 4.37288C13.2537 4.37065 13.3165 4.37693 13.3776 4.39155C13.8331 5.57151 13.5456 6.44527 13.4597 6.66185C13.9937 7.26303 14.3185 8.02851 14.3185 8.96202C14.3185 12.2554 12.3619 12.9799 10.4986 13.1927C10.7973 13.4578 11.0662 13.9806 11.0662 14.7797C11.0662 15.926 11.055 16.8521 11.055 17.1321C11.055 17.3337 11.1707 17.5615 11.4807 17.5615C11.5308 17.5617 11.5809 17.5567 11.63 17.5466C14.9571 16.4114 17.3506 13.1964 17.3506 9.41011C17.3506 4.67534 13.6053 0.833008 8.98633 0.833008Z" fill="white"/>
</svg>
</div>
				
					</a>
				
			
		
			
				
				
					<a href="https://zenodo.org/communities/openforcefield/?page=1&amp;size=20">
				
				<div class="footer-icon"><svg width="27" height="10" viewBox="0 0 27 10" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M22.15 7.99361C21.7106 8.91738 21.0047 9.45437 19.972 9.45812C18.9393 9.46188 18.2259 8.9324 17.779 8.01614C17.3809 8.86481 16.7238 9.37926 15.7775 9.45061C14.8312 9.52196 14.1027 9.1164 13.577 8.31655C13.577 8.35035 13.5732 8.37288 13.5732 8.39541C13.5732 8.59444 13.577 8.79721 13.5695 8.99624C13.5619 9.24783 13.3479 9.45812 13.0926 9.46563C12.8184 9.46939 12.6081 9.27788 12.5894 9.01501C12.5856 8.97371 12.5856 8.93616 12.5856 8.89485C12.5856 7.67818 12.5856 6.4615 12.5856 5.24483C12.5856 4.62147 12.1913 4.08073 11.6168 3.91175C10.7343 3.65264 9.87062 4.28727 9.86311 5.20728C9.85936 5.66916 9.86311 6.13105 9.86311 6.59294C9.86311 6.62298 9.86311 6.65677 9.86311 6.69057C8.40611 6.69057 6.95662 6.69057 5.51464 6.69057C5.50713 6.70183 5.49962 6.70559 5.49962 6.70934C5.49211 7.06984 5.46957 7.43034 5.65733 7.76079C5.93146 8.23394 6.33326 8.48554 6.88152 8.47427C7.43352 8.46676 7.83157 8.20014 8.08317 7.71197C8.11696 7.64438 8.15076 7.58054 8.1808 7.50919C8.25966 7.32895 8.3986 7.21629 8.59011 7.21254C9.00694 7.20503 9.42751 7.20878 9.85185 7.20878C9.8556 7.23131 9.85936 7.25384 9.85936 7.27262C9.85936 7.83214 9.86311 8.39166 9.85936 8.95118C9.8556 9.2929 9.5627 9.52196 9.236 9.4431C9.02947 9.39429 8.87926 9.20277 8.87551 8.98873C8.87175 8.76717 8.87551 8.54562 8.87551 8.30153C8.48872 8.90987 7.97427 9.30041 7.27581 9.42057C6.58861 9.54074 5.95774 9.38302 5.39447 8.95118C5.39072 8.98122 5.38696 8.99624 5.3832 9.01501C5.33063 9.24408 5.13912 9.40555 4.90254 9.40931C4.41813 9.41306 3.93747 9.40931 3.45305 9.40931C2.70202 9.40931 1.95474 9.4018 1.20371 9.41306C0.865745 9.41682 0.632925 9.16897 0.644191 8.84979C0.655456 8.3879 0.62166 8.44798 0.903297 8.06871C1.90593 6.71686 2.90855 5.36875 3.91118 4.01689C3.92996 3.99061 3.95249 3.96057 3.98253 3.91926C3.94122 3.91926 3.91494 3.91926 3.8849 3.91926C3.00619 3.91926 2.12372 3.91926 1.24502 3.91926C1.00093 3.91926 0.805663 3.78032 0.741825 3.56252C0.644191 3.23582 0.880766 2.91663 1.23 2.91288C1.57923 2.90912 1.92846 2.91288 2.27769 2.91288C3.06627 2.91288 3.85485 2.92039 4.64719 2.90912C4.99267 2.90537 5.25553 3.10814 5.24426 3.48742C5.86011 2.94292 6.56608 2.74389 7.35466 2.91663C8.15076 3.08937 8.69526 3.58129 9.02571 4.32106C9.47258 3.40105 10.1823 2.86781 11.2187 2.86781C12.2514 2.87157 12.9611 3.40105 13.3967 4.31731C13.8361 3.40105 14.5496 2.86781 15.5822 2.86781C16.6186 2.86781 17.3284 3.4048 17.7715 4.33233C18.0719 3.64513 18.5638 3.17198 19.2848 2.95794C20.0058 2.74389 20.6742 2.87532 21.3126 3.29966C21.3126 3.25835 21.3126 3.23206 21.3126 3.20578C21.3126 2.61997 21.3126 2.03417 21.3126 1.44461C21.3126 1.17048 21.4741 0.975212 21.7332 0.933906C22.0148 0.888844 22.2927 1.11791 22.2927 1.4033C22.2965 2.09801 22.2927 2.79647 22.2927 3.49117C22.2927 3.5137 22.2889 3.53999 22.2777 3.55876C22.1387 3.79158 22.1049 4.05445 22.0824 4.31731C22.0787 4.36237 22.0787 4.40743 22.0862 4.45249C22.1049 4.40368 22.1237 4.35486 22.1462 4.30604C22.4955 3.50619 23.1038 3.02553 23.9637 2.88659C25.2405 2.6763 26.4722 3.59632 26.6412 4.87307C26.6524 4.9707 26.66 5.06834 26.66 5.16973C26.66 5.83064 26.6637 6.49155 26.66 7.15245C26.6524 8.23019 25.9089 9.14644 24.8575 9.39429C23.7685 9.64964 22.6682 9.1164 22.1913 8.10251C22.1913 8.07622 22.1725 8.03867 22.15 7.99361ZM21.3201 6.16485C21.3239 6.16485 21.3239 6.16485 21.3276 6.16485C21.3276 5.86443 21.3314 5.56402 21.3276 5.25985C21.3239 5.13969 21.3201 5.01952 21.2901 4.90311C21.1324 4.21967 20.509 3.79158 19.7955 3.86669C19.1421 3.93428 18.6126 4.52384 18.6089 5.20352C18.6051 5.84941 18.6051 6.4953 18.6089 7.13743C18.6126 7.89973 19.221 8.48929 19.9833 8.47803C20.693 8.46676 21.2713 7.93728 21.3164 7.22756C21.3389 6.87457 21.3201 6.51783 21.3201 6.16485ZM14.2379 6.16485C14.2379 6.49154 14.2341 6.822 14.2379 7.1487C14.2529 8.0612 15.1504 8.69958 16.0178 8.41794C16.5849 8.23394 16.9529 7.72324 16.9529 7.09988C16.9566 6.48028 16.9529 5.86443 16.9529 5.24483C16.9529 5.16597 16.9491 5.09087 16.9378 5.01201C16.8364 4.32857 16.2056 3.81411 15.5259 3.85918C14.7936 3.90799 14.2491 4.46376 14.2379 5.18099C14.2341 5.50769 14.2379 5.83439 14.2379 6.16485ZM25.6911 6.1686C25.6911 5.85692 25.6911 5.54524 25.6911 5.23357C25.6911 5.15471 25.6874 5.07209 25.6723 4.99324C25.5559 4.34735 25.0603 3.90424 24.4069 3.85918C23.6708 3.8066 23.0137 4.38114 22.9761 5.11716C22.9649 5.32369 22.9724 5.53398 22.9724 5.74051C22.9724 6.23244 22.9574 6.72812 22.9799 7.22005C23.0099 7.99736 23.7722 8.59444 24.5383 8.46676C25.2292 8.35035 25.6911 7.80585 25.6911 7.10739C25.6911 6.79196 25.6911 6.48028 25.6911 6.1686ZM1.91719 8.41043C2.91982 8.41043 3.90367 8.41043 4.89879 8.41043C4.88377 8.38415 4.8725 8.36537 4.86124 8.35035C4.62466 7.97108 4.50825 7.55426 4.51201 7.10739C4.51576 6.47652 4.51201 5.84941 4.51201 5.21855C4.51201 5.11716 4.51201 5.01952 4.51201 4.91438C3.65208 6.07472 2.78839 7.23882 1.91719 8.41043ZM8.20709 5.70296C8.20709 5.47014 8.22962 5.24108 8.20333 5.01952C8.13198 4.42621 7.62504 3.93804 7.03923 3.87044C6.41212 3.79534 5.84133 4.12579 5.601 4.69282C5.46206 5.01952 5.51088 5.36124 5.49962 5.70296C6.40836 5.70296 7.3096 5.70296 8.20709 5.70296Z" fill="white"/>
</svg>
</div>
				
					</a>
				
			
		
			
				
				
					<a href="https://www.linkedin.com/company/openforcefield/">
				
				<div class="footer-icon"><svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M16.345 0.833008H2.38374C1.62087 0.833008 0.954346 1.38191 0.954346 2.13582V16.128C0.954346 16.886 1.62087 17.5615 2.38374 17.5615H16.3409C17.1078 17.5615 17.6829 16.8816 17.6829 16.128V2.13582C17.6873 1.38191 17.1078 0.833008 16.345 0.833008ZM6.13981 14.7771H3.7433V7.32577H6.13981V14.7771ZM5.02446 6.19286H5.00728C4.24031 6.19286 3.74368 5.62192 3.74368 4.90722C3.74368 4.17946 4.25337 3.62197 5.03752 3.62197C5.82167 3.62197 6.3015 4.17535 6.31868 4.90722C6.3183 5.62192 5.82167 6.19286 5.02446 6.19286ZM14.8984 14.7771H12.5019V10.7028C12.5019 9.72676 12.1531 9.05986 11.2861 9.05986C10.6237 9.05986 10.2316 9.50794 10.0572 9.94445C9.99185 10.1013 9.97431 10.3149 9.97431 10.5329V14.7771H7.5778V7.32577H9.97431V8.36271C10.3231 7.86608 10.8679 7.15139 12.1356 7.15139C13.7087 7.15139 14.8988 8.18833 14.8988 10.4239L14.8984 14.7771Z" fill="white"/>
</svg>
</div>
				
					</a>
				
			
		
			
				
				
					<a href="https://www.youtube.com/channel/UCh0aJSUm_sYr7nuTzhW806g">
				
				<div class="footer-icon"><svg width="22" height="17" viewBox="0 0 22 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M21.3762 3.78816C21.3762 1.93759 20.015 0.448904 18.3331 0.448904C16.0548 0.342393 13.7313 0.30127 11.3568 0.30127H10.6166C8.24785 0.30127 5.92024 0.342393 3.64198 0.449315C1.96412 0.449315 0.602924 1.94622 0.602924 3.7968C0.500114 5.2604 0.456523 6.72441 0.45899 8.18842C0.454878 9.65242 0.501485 11.1178 0.598811 12.5846C0.598811 14.4351 1.96001 15.9362 3.63786 15.9362C6.03127 16.0472 8.48637 16.0965 10.9826 16.0924C13.4829 16.1006 15.9312 16.0486 18.3273 15.9362C20.0093 15.9362 21.3705 14.4351 21.3705 12.5846C21.4692 11.1164 21.5144 9.65242 21.5103 8.1843C21.5196 6.72029 21.4749 5.25491 21.3762 3.78816ZM8.97163 12.2227V4.14183L14.9346 8.18019L8.97163 12.2227Z" fill="white"/>
</svg>
</div>
				
					</a>
				
			
		
			
				
				
					<a href="http://eepurl.com/gYuojL">
				
				<div class="footer-icon"><svg width="19" height="21" viewBox="0 0 19 21" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14.0794 9.62959C14.2146 9.62959 14.3498 9.62959 14.485 9.62959C14.5711 9.44519 14.5711 9.17475 14.485 8.86743C14.399 8.4126 14.2638 8.10528 13.9933 8.14215C13.7229 8.19133 13.7229 8.54782 13.8089 9.00265C13.8458 9.27309 13.9442 9.49437 14.0794 9.62959Z" fill="white"/>
<path d="M11.6945 10.0353C11.8789 10.1214 12.0141 10.1706 12.051 10.1214C12.1001 10.0722 12.051 10.0353 12.0018 9.93699C11.9157 9.7526 11.6822 9.61738 11.5101 9.53133C11.0552 9.34694 10.5635 9.39611 10.1579 9.71572C10.0226 9.80177 9.88742 9.93699 9.93659 10.0353C9.93659 10.0845 9.98576 10.0845 10.0226 10.0845C10.1087 10.0845 10.5144 9.90011 10.9692 9.86323C11.2396 9.85094 11.5101 9.94928 11.6945 10.0353Z" fill="white"/>
<path d="M11.2888 10.2562C11.0184 10.3053 10.8831 10.3914 10.7971 10.4774C10.711 10.5635 10.6619 10.6126 10.6619 10.6618V10.711H10.711C10.7602 10.711 10.8954 10.6618 10.8954 10.6618C11.2519 10.5266 11.4855 10.5266 11.7068 10.5758C11.842 10.5758 11.8911 10.6249 11.928 10.5758C11.928 10.5758 11.928 10.5266 11.928 10.4897C11.9157 10.3545 11.6453 10.2193 11.2888 10.2562Z" fill="white"/>
<path d="M11.4241 10.5758C11.5102 10.3914 11.5102 9.98572 11.4241 9.6784C11.3381 9.22357 11.2028 8.95312 10.8832 8.95312C10.6128 9.0023 10.6128 9.35879 10.6988 9.8505C10.748 10.1701 10.8832 10.3422 10.9201 10.4774C11.1537 10.8462 11.2889 10.7479 11.4241 10.5758Z" fill="white"/>
<path d="M13.268 11.0678C13.4524 11.1538 13.6245 11.117 13.7228 10.9817C13.772 10.8465 13.6736 10.6621 13.5015 10.5761C13.3171 10.49 13.145 10.5269 13.0467 10.6621C12.9484 10.7973 13.0836 10.9817 13.268 11.0678Z" fill="white"/>
<path d="M14.3867 10.084C14.2514 10.084 14.1162 10.2192 14.1162 10.4405C14.1162 10.6249 14.2023 10.797 14.3867 10.797C14.5219 10.797 14.6571 10.6617 14.6571 10.4405C14.6202 10.2561 14.5219 10.084 14.3867 10.084Z" fill="white"/>
<path d="M4.85982 13.5878C4.81064 13.5386 4.77377 13.5386 4.7246 13.5878C4.67542 13.5878 4.63855 13.5878 4.58937 13.5878C4.50332 13.5878 4.40498 13.5386 4.3681 13.4525C4.33122 13.3665 4.31893 13.2313 4.3681 13.0469L4.41727 12.9608C4.5525 12.6904 4.73689 12.2847 4.50332 11.8791C4.31893 11.5594 4.09766 11.3873 3.77805 11.3382C3.45843 11.289 3.15111 11.4242 2.96672 11.6578C2.64711 12.0143 2.61023 12.4691 2.64711 12.6412C2.64711 12.6904 2.69628 12.7273 2.73316 12.7273C2.78233 12.7273 2.86838 12.6781 2.91755 12.5429V12.4937C2.91755 12.4076 2.96672 12.3093 3.05277 12.1741C3.13882 12.0389 3.27404 11.9528 3.40926 11.9528C3.54448 11.9036 3.72888 11.9528 3.8641 12.0389C4.08537 12.1741 4.18371 12.4445 4.08537 12.715C3.95015 12.8502 3.90098 13.0715 3.90098 13.305C3.95015 13.7107 4.22059 13.8951 4.44186 13.932C4.66313 13.932 4.84752 13.7967 4.84752 13.7107C4.89669 13.6369 4.85982 13.6369 4.85982 13.5878Z" fill="white"/>
<path d="M17.9393 12.8256C17.9393 12.7764 17.8901 12.6043 17.8041 12.3339L17.6197 11.9282C17.9393 11.4734 17.9393 11.0308 17.8901 10.8096C17.8409 10.5391 17.7057 10.2687 17.4845 9.99822C17.2632 9.72778 16.7223 9.45734 16.0462 9.27295L15.6897 9.1869C15.6897 9.1869 15.6897 8.3264 15.6405 7.96991C15.6405 7.69947 15.5914 7.29381 15.4561 6.88814C15.3209 6.34726 15.0505 5.85555 14.694 5.53593C15.5914 4.58939 16.1814 3.50761 16.1814 2.61024C16.1814 0.901538 14.0671 0.360654 11.4118 1.44242L10.8709 1.66369C10.8709 1.66369 9.88749 0.680267 9.83832 0.680267C6.92492 -1.92581 -2.38074 8.46162 0.58183 10.9816L1.20876 11.5225C1.02437 11.9774 0.987493 12.4691 1.02437 13.01C1.11042 13.6861 1.47921 14.3622 2.0078 14.9031C2.54868 15.3948 3.26166 15.7144 3.98694 15.7144C5.15476 18.4188 7.81001 20.0292 10.9078 20.1275C14.2392 20.2136 17.0665 18.6401 18.2343 15.8496C18.3204 15.6652 18.64 14.7678 18.64 13.9565C18.7137 13.1329 18.2589 12.8256 17.9393 12.8256ZM4.26968 14.9399C4.18363 14.9399 4.0484 14.9891 3.95006 14.9399C2.96664 14.8908 1.8357 13.9934 1.74965 12.9116C1.6636 11.7438 2.24136 10.8464 3.32313 10.6129C3.45835 10.5637 3.59357 10.5637 3.77796 10.5637C4.36802 10.6129 5.26539 11.0554 5.48666 12.3584C5.65876 13.5877 5.40061 14.7555 4.26968 14.9399ZM3.15103 9.89988C2.47492 10.0351 1.89716 10.3916 1.52838 10.9325C1.30711 10.7481 0.901443 10.3916 0.852272 10.2564C0.262217 9.17461 1.47921 7.02336 2.3397 5.84325C4.4049 2.88068 7.68708 0.631096 9.17451 1.02447C9.44495 1.11052 10.2563 2.05706 10.2563 2.05706C10.2563 2.05706 8.73197 2.91756 7.33059 4.08538C5.43749 5.48676 3.99923 7.60113 3.15103 9.89988ZM13.7597 14.4851L13.8089 14.4359C13.8089 14.3868 13.7597 14.3868 13.7597 14.3868C13.7597 14.3868 12.1863 14.608 10.6988 14.0671C10.8832 13.5263 11.2889 13.7107 11.9527 13.7967C13.1205 13.8828 14.2023 13.7107 14.9644 13.4771C15.6405 13.2927 16.5379 12.887 17.214 12.3584C17.4353 12.8502 17.5336 13.4402 17.5336 13.4402C17.5336 13.4402 17.718 13.391 17.8532 13.4894C17.9885 13.5754 18.0745 13.7598 18.0376 14.2147C17.9024 15.112 17.4967 15.7881 16.919 16.4642C16.5625 16.8699 16.0585 17.2264 15.5299 17.4968C15.2595 17.6321 14.9398 17.7673 14.6325 17.8533C12.1985 18.6155 9.77686 17.8042 9.0147 15.9602C8.96553 15.825 8.87948 15.6898 8.87948 15.5054C8.55987 14.2884 8.83031 12.8502 9.73998 11.9528C9.78915 11.9036 9.82603 11.8176 9.82603 11.7315C9.82603 11.6455 9.77686 11.5963 9.73998 11.5471C9.42037 11.0923 8.35089 10.3301 8.57216 8.8427C8.70738 7.76093 9.65393 7.04795 10.5021 7.08482H10.7234C11.0799 7.08482 11.4487 7.17088 11.7068 7.17088C12.1985 7.17088 12.6903 7.1217 13.2311 6.67916C13.4155 6.54394 13.5508 6.40872 13.8212 6.35955C13.8704 6.35955 13.9072 6.31038 14.0425 6.35955C14.1777 6.35955 14.3129 6.40872 14.399 6.49477C14.8538 6.81438 14.8907 7.4782 14.9398 8.01908C14.9398 8.33869 14.989 9.05168 14.989 9.23607C15.0382 9.6909 15.1242 9.77695 15.3947 9.863C15.5299 9.91217 15.6651 9.94905 15.8495 9.99822C16.4396 10.1826 16.7961 10.3178 17.0173 10.5391C17.1525 10.6743 17.2017 10.8096 17.2386 10.9448C17.3246 11.4365 16.8329 12.0634 15.6159 12.6535C14.2637 13.2804 12.6903 13.4156 11.5716 13.2804L11.1659 13.2312C10.2686 13.096 9.77686 14.2638 10.3054 15.026C10.6619 15.5177 11.6085 15.8865 12.5059 15.8865C14.6694 15.8865 16.3289 14.9891 16.919 14.1778L16.9682 14.0917C17.0173 14.0426 16.9682 14.0057 16.919 14.0426C16.4273 14.3991 14.1777 15.7513 11.7929 15.3456C11.7929 15.3456 11.5224 15.2964 11.252 15.2104C11.0307 15.1243 10.6251 14.9399 10.5267 14.4851C12.5427 15.0752 13.7597 14.4851 13.7597 14.4851ZM7.01097 5.85554C7.73625 4.99505 8.6705 4.23289 9.48183 3.82723C9.531 3.82723 9.531 3.82723 9.531 3.8764C9.48183 4.01162 9.34661 4.23289 9.30973 4.41728C9.30973 4.46646 9.3589 4.46646 9.3589 4.46646C9.85061 4.10996 10.748 3.74118 11.5224 3.7043C11.5716 3.7043 11.5716 3.75347 11.5716 3.75347C11.4364 3.83952 11.3503 3.97474 11.2151 4.10996C11.2151 4.10996 11.2151 4.15914 11.2643 4.15914C11.8052 4.15914 12.5673 4.34353 13.059 4.65085C13.1082 4.65085 13.059 4.7369 13.0099 4.7369C12.2477 4.55251 11.0307 4.41729 9.72769 4.7369C8.55987 5.00734 7.69937 5.46218 7.07244 5.90472C7.01097 5.89242 6.9741 5.89242 7.01097 5.85554Z" fill="white"/>
</svg>
</div>
				
					</a>
				
			
		
		<div><br />Content licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0.</a><br />Website by <a href="https://www.vanleeuwenvanleeuwen.nl/">van Leeuwen & van Leeuwen</a><br />and the Open Force Field Initiative.</div>
	</div>
</footer>

</body>
</html>
